# CSA
CSA (Captain Sonar Assist) is a tool to assist in winning games of Captain Sonar.

**Features:**
- Keeps track of your position and history
- Tracks down your enemy, including on maps such as Kilo where this is normally very difficult.
- Keeps track of the engineering and first mate boards.

**Dependencies:**
- gtk4 (https://www.gtk.org/)
- luajit (https://luajit.org/)
- VCL (https://github.com/vectorclass/version2 - this is a submodule which is automatically initialised by the makefile when the relevant build variable is set to enable use of SSE vectorisation)
- lrzip (https://github.com/ckolivas/lrzip - only needed if you intend to create distributions compressed using `lrzip`)

**To build:**
- Clone https://github.com/hiornso/csa
- `cd csa`
- `make -j$(nproc)`
- `./csa`

**Benchmarking:**
- `make testbench`
- `./testbench`

This will run 50 back-to-back map renders of a test map at a 1000x1000 resolution and print the time taken. This is a standardised way of testing the performance of the map rendering, which is by far the most performance-needing part of CSA. It allows easy comparison of different settings, for example to see whether LTO or using VCL make a difference (positive or negative) on your machine. If the testbench is compiled with `OUTPUT_PNG=1` (this can be achieved with `CFLAGS="-DOUTPUT_PNG=1" make`) then it will also produce an image called `testbench.png` which is the result of rendering the map - this allows you to verify that the map was rendered correctly, and that you aren't testing how fast it is to render a blank screen.

**To install:**
- `make install`

**To uninstall:**
- `make uninstall`

**To make a distribution:**
- `make distrib`

**To clean the directory:**
- `make clean`
This removes the `csa` and `testbench` executables, object files, the extracted VCL source if it was extracted, `testbench.png` if it was created by the testbench, `resources.c` (this is autogenerated) and `resources/builder/menu.ui` (this is copied into this location from `linuxdeps` or `darwindeps` since it is OS-dependent).

**Further build customisation:**

Most of these will not need to be modified - the Makefile is designed to make sensible decisions and be aware of the system it is being run on.
- `OPT_LEVEL=3 make` sets the level of optimisation (internally used with `-O`). Result: passed as a compiler flag to control optimisation type. Default: `3` (fastest sensible setting)
- `USE_LTO=1 make` enables LTO (link-time optimisation). Result: slower compiles, marginally smaller and faster executable. Default: `0` (off)
- `USE_VCL=1 make` enables use of VCL (Agner Fog's Vectorclass library). Result: use of hardware vectors. This may slightly improve map rendering performance on some machines. Default: `0` (off)
- `CC=clang CXX=clang++ make` specifies the C/C++ compilers to use. Result: uses the specified compilers. Default: `clang`, `clang++`
- `DO_GZIP_DISTRIB=1 DO_LRZIP_DISTRIB=1 make` specifies whether or not to make differently-compressed versions of distributions, when creating distributions with `make distrib`. Result: whether or not distributions compressed with `gzip`/`lrzip` are created. Default: both `1` (on)
- `DISTRIB_DIR=distrib make distrib` specifies the directory in which to put the created distributions when creating them with `make distrib`. Result: sets the directory to put created distributions in. Default: `distrib`
- `DISTRIB_FILENAME=$(shell date +"csa_%F_%H-%M-%S") make distrib` specifies the name of the created distribution archive (to which an extension will be added corresponding to the type of compression). Result: sets the name of the distribution file. Default: `$(shell date +"csa_%F_%H-%M-%S")` (generates a name like `csa_2021-05-13_23-30-45` for example, if the date and time was 23:30:45 on 2021-05-13, to which a suffix of `.tar.gz`/`.tar.lrz` will be appended when creating the relevant distribution)
- `MACOS_APP_NAME=Captain\ Sonar\ Assist.app make` specifies the name of the app bundle to be created when compiling on MacOS (this is created in addition to the executable itself). Result: sets the name of the app bundle on MacOS. Default: `Captain Sonar Assist.app`
- `TAR=tar LRZIP=lrzip make` specifies the programs to be used for tarring (done when creating any distribution archives) and lrzipping (done when creating `.tar.lrz` distribution archives specifically). On MacOS/BSD, `gtar` must be used rather than `tar` so that the `--transform` switch is available (used to format paths in the distribution archives correctly during creation) - `gtar` is used automatically when MacOS is detected.
There are some other settings available in the Makefile, but messing with them will likely break things unless you know what you're doing - if you want to learn how to use them, I'd recommend looking at the source.

**How to use CSA:**

Run the executable, load a map using the dropdown, enter all actions performed by yourself or by your opponent... (A proper manual is on the to-do list).
